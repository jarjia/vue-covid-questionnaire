<template>
  <Layout>
    <div class="grid grid-cols-2 gap-2">
      <Form @submit="handleSubmit" class="pl-2 pt-2">
        <div class="mb-3 mt-2">
          <label className="text-lg font-sans text-primary font-bold">
            рЃБрЃЎрЃЋрЃћ рЃљрЃфрЃарЃўрЃџрЃў рЃ«рЃљрЃа?*
          </label>
          <div class="mb-2 mt-2 pl-2">
            <label
              class="flex items-center text-primary font-normal gap-[15px] mb-2"
            >
              <Field
                type="radio"
                rules="required"
                name="is_vaccinated"
                value="рЃЎрЃў"
                v-model="is_vaccinated"
                class="h-[20px] w-[20px] text-black accent-blue-700"
                key="is_vaccinated_1"
              />рЃЎрЃў</label
            >
            <label
              class="flex items-center text-primary font-normal gap-[15px] mb-2"
            >
              <Field
                type="radio"
                name="is_vaccinated"
                value="рЃљрЃарЃљ"
                v-model="is_vaccinated"
                class="h-[20px] w-[20px] text-black accent-blue-700"
                key="is_vaccinated_2"
              />рЃљрЃарЃљ</label
            >
            <div class="relative">
              <ErrorMessage
                name="had_antibodies"
                class="absolute text-red-500"
              />
            </div>
          </div>
        </div>
        <div v-if="is_vaccinated === 'рЃЎрЃў'" class="mb-3 mt-2">
          <label className="text-lg font-sans text-primary font-bold">
            рЃљрЃўрЃарЃЕрЃўрЃћ рЃарЃљ рЃћрЃбрЃљрЃърЃќрЃћ рЃ«рЃљрЃа*
          </label>
          <div class="mb-2 mt-2 pl-2">
            <label
              class="flex items-center text-primary font-normal gap-[15px] mb-2"
            >
              <Field
                type="radio"
                rules="required"
                name="what_stage"
                value="рЃърЃўрЃарЃЋрЃћрЃџрЃў_рЃЊрЃЮрЃќрЃљ_рЃЊрЃљ_рЃЊрЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў_рЃЋрЃљрЃа_рЃЏрЃћрЃЮрЃарЃћрЃќрЃћ"
                v-model="what_stage"
                class="h-[20px] w-[20px] text-black accent-blue-700"
                key="what_stage_1"
              />рЃърЃўрЃарЃЋрЃћрЃџрЃў рЃЊрЃЮрЃќрЃљ рЃЊрЃљ рЃЊрЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў рЃЋрЃљрЃа рЃЏрЃћрЃЮрЃарЃћрЃќрЃћ</label
            >
            <label
              class="flex items-center text-primary font-normal gap-[15px] mb-2"
            >
              <Field
                type="radio"
                name="what_stage"
                value="рЃАрЃарЃБрЃџрЃљрЃЊ_рЃљрЃфрЃарЃўрЃџрЃў_рЃЋрЃљрЃа"
                v-model="what_stage"
                class="h-[20px] w-[20px] text-black accent-blue-700"
                key="what_stage_2"
              />рЃАрЃарЃБрЃџрЃљрЃЊ рЃљрЃфрЃарЃўрЃџрЃў рЃЋрЃљрЃа</label
            >
            <label
              class="flex items-center text-primary font-normal gap-[15px] mb-2"
            >
              <Field
                type="radio"
                name="what_stage"
                value="рЃърЃўрЃарЃЋрЃћрЃџрЃў_рЃЊрЃЮрЃќрЃљ_рЃЊрЃљ_рЃљрЃа_рЃЊрЃљрЃЋрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃЋрЃљрЃа_рЃЏрЃћрЃЮрЃарЃћрЃќрЃћ"
                v-model="what_stage"
                class="h-[20px] w-[20px] text-black accent-blue-700"
                key="what_stage_3"
              />рЃърЃўрЃарЃЋрЃћрЃџрЃў рЃЊрЃЮрЃќрЃљ рЃЊрЃљ рЃљрЃа рЃЊрЃљрЃЋрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃЋрЃљрЃа рЃЏрЃћрЃЮрЃарЃћрЃќрЃћ</label
            >
            <div class="relative">
              <ErrorMessage
                name="had_antibodies"
                class="absolute text-red-500"
              />
            </div>
          </div>
        </div>
        <div v-if="is_vaccinated === 'рЃљрЃарЃљ'" class="mb-3 mt-2">
          <label className="text-lg font-sans text-primary font-bold">
            рЃарЃљрЃА рЃћрЃџрЃЮрЃЊрЃћрЃЉрЃў?*
          </label>
          <div class="mb-2 mt-2 pl-2">
            <label
              class="flex items-center text-primary font-normal gap-[15px] mb-2"
            >
              <Field
                type="radio"
                rules="required"
                name="why_wait"
                value="рЃЊрЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў_рЃЋрЃљрЃа_рЃЊрЃљ_рЃЋрЃћрЃџрЃЮрЃЊрЃћрЃЉрЃў_рЃарЃўрЃфрЃ«рЃЋрЃА"
                v-model="why_wait"
                class="h-[20px] w-[20px] text-black accent-blue-700"
                key="why_wait_1"
              />рЃЊрЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў рЃЋрЃљрЃа рЃЊрЃљ рЃЋрЃћрЃџрЃЮрЃЊрЃћрЃЉрЃў рЃарЃўрЃфрЃ«рЃЋрЃА</label
            >
            <label
              class="flex items-center text-primary font-normal gap-[15px] mb-2"
            >
              <Field
                type="radio"
                name="why_wait"
                value="рЃљрЃа_рЃЋрЃњрЃћрЃњрЃЏрЃљрЃЋ"
                v-model="why_wait"
                class="h-[20px] w-[20px] text-black accent-blue-700"
                key="why_wait_2"
              />рЃљрЃа рЃЋрЃњрЃћрЃњрЃЏрЃљрЃЋ</label
            >
            <label
              class="flex items-center text-primary font-normal gap-[15px] mb-2"
            >
              <Field
                type="radio"
                name="why_wait"
                value="рЃњрЃљрЃЊрЃљрЃбрЃљрЃюрЃўрЃџрЃў_рЃЏрЃљрЃЦрЃЋрЃА_рЃЊрЃљ_рЃЋрЃњрЃћрЃњрЃЏрЃљрЃЋ_рЃљрЃфрЃарЃљрЃА"
                v-model="why_wait"
                class="h-[20px] w-[20px] text-black accent-blue-700"
                key="why_wait_3"
              />рЃњрЃљрЃЊрЃљрЃбрЃљрЃюрЃўрЃџрЃў рЃЏрЃљрЃЦрЃЋрЃА рЃЊрЃљ рЃЋрЃњрЃћрЃњрЃЏрЃљрЃЋ рЃљрЃфрЃарЃљрЃА</label
            >
            <div class="relative">
              <ErrorMessage
                name="had_antibodies"
                class="absolute text-red-500"
              />
            </div>
          </div>
        </div>
        <div class="p-12 pt-8">
          <div
            v-if="
              is_vaccinated === 'рЃЎрЃў' &&
              what_stage === 'рЃърЃўрЃарЃЋрЃћрЃџрЃў_рЃЊрЃЮрЃќрЃљ_рЃЊрЃљ_рЃЊрЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃћрЃЉрЃБрЃџрЃў_рЃЋрЃљрЃа_рЃЏрЃћрЃЮрЃарЃћрЃќрЃћ'
            "
          >
            <p>рЃарЃЮрЃЏ рЃљрЃа рЃњрЃљрЃЊрЃљрЃЊрЃЮ,</p>
            <p>рЃЉрЃљрЃарЃћрЃЏ рЃљрЃ«рЃџрЃљрЃЋрЃћ рЃЊрЃљрЃарЃћрЃњрЃўрЃАрЃбрЃарЃўрЃарЃЊрЃў</p>
            <a
              href="https://booking.moh.gov.ge/"
              class="text-[#1289AE] hover:underline"
              target="_blank"
              >https://booking.moh.gov.ge/</a
            >
          </div>
          <div v-else-if="is_vaccinated === 'рЃљрЃарЃљ' && why_wait === 'рЃљрЃа_рЃЋрЃњрЃћрЃњрЃЏрЃљрЃЋ'">
            <a
              href="https://booking.moh.gov.ge/"
              class="text-[#1289AE] hover:underline"
              target="_blank"
              >­ЪЉЅ https://booking.moh.gov.ge/</a
            >
          </div>
          <div
            v-else-if="
              is_vaccinated === 'рЃљрЃарЃљ' &&
              why_wait === 'рЃњрЃљрЃЊрЃљрЃбрЃљрЃюрЃўрЃџрЃў_рЃЏрЃљрЃЦрЃЋрЃА_рЃЊрЃљ_рЃЋрЃњрЃћрЃњрЃЏрЃљрЃЋ_рЃљрЃфрЃарЃљрЃА'
            "
          >
            <p class="pb-6">
              рЃљрЃ«рЃљрЃџрЃў рЃърЃарЃЮрЃбрЃЮрЃЎрЃЮрЃџрЃўрЃЌ рЃЎрЃЮрЃЋрЃўрЃЊрЃўрЃА рЃњрЃљрЃЊрЃљрЃбрЃљрЃюрЃўрЃЊрЃљрЃю 1 рЃЌрЃЋрЃўрЃА рЃерЃћрЃЏрЃЊрЃћрЃњ рЃерЃћрЃњрЃўрЃФрЃџрЃўрЃљрЃЌ
              рЃЋрЃљрЃЦрЃфрЃўрЃюрЃўрЃА рЃњрЃљрЃЎрЃћрЃЌрЃћрЃЉрЃљ.
            </p>
            <p>­ЪЉЅ рЃарЃћрЃњрЃўрЃАрЃбрЃарЃљрЃфрЃўрЃўрЃА рЃЉрЃЏрЃБрЃџрЃў</p>
            <a
              href="https://booking.moh.gov.ge/"
              class="text-[#1289AE] hover:underline"
              target="_blank"
              >https://booking.moh.gov.ge/</a
            >
          </div>
        </div>
        <PageButtons prev="/covid-questionnaire" />
      </Form>
      <img src="/doctor.png" />
    </div>
  </Layout>
</template>

<script setup lang="ts">
import { Layout, PageButtons } from "@/components";
import { Form, Field, ErrorMessage, defineRule } from "vee-validate";
import { ref, onBeforeMount } from "vue";
import { Vaccine } from "../../store/types";
import { useFormData } from "@/store";
import router from "@/routes";

const form = useFormData();

onBeforeMount(() => {
  let allowed = parseFloat(sessionStorage.getItem("allow") as string);
  if (allowed < 3) {
    router.push("/");
  }
});

const is_vaccinated = ref(form.is_vaccinated);
const why_wait = ref(form.why_wait);
const what_stage = ref(form.what_stage);

defineRule("required", (value: string) => {
  let val = String(value);

  if (!val || !val.length) {
    return "рЃњрЃЌрЃ«рЃЮрЃЋрЃЌ рЃЏрЃЮрЃюрЃўрЃерЃюрЃЮрЃЌ рЃћрЃарЃЌрЃћрЃарЃЌрЃў рЃърЃљрЃАрЃБрЃ«рЃў";
  }
  return true;
});

const handleSubmit = () => {
  let data: Vaccine = {
    is_vaccinated: is_vaccinated.value,
    why_wait: why_wait.value,
    what_stage: what_stage.value,
  };

  form.setVaccine(data);

  sessionStorage.setItem("allow", "4");

  router.push("/tips");
};
</script>
